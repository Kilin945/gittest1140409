<!DOCTYPE html>
<html>
    <head>
        <title>YouTube æ’­æ”¾æ¸…å–® Demo</title>
    </head>

    <body>
        <h1>ğŸ“º YouTube æ’­æ”¾æ¸…å–® API æ¸¬è©¦</h1>

        <button onclick="handleAuthClick()">ğŸ” ç™»å…¥ Google</button>
        <button onclick="listPlaylists()">ğŸ“‚ è®€å–æˆ‘çš„æ’­æ”¾æ¸…å–®</button>

        <ul id="playlistList"></ul>

        <script src="https://accounts.google.com/gsi/client" async defer></script>
        <script src="https://apis.google.com/js/api.js" async defer></script>

        <script>
            //å®šç¾©google OAuth å®¢æˆ¶ç«¯ID
            const CLIENT_ID = "407957494432-1u5v186r9hnd126pgfirfcuu8nn2ccuh.apps.googleusercontent.com";
            //å®šç¾©æ¬Šé™ç¯„åœ:åªè®€youtubeè³‡æ–™
            const SCOPES = "https://www.googleapis.com/auth/youtube.readonly";
            //å®šç¾©youtube api v3çš„æ¢ç´¢æ–‡ä»¶url
            const DISCOVERY_DOC = "https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest";

            let tokenClient; //å„²å­˜OAuth tokençš„å®¢æˆ¶ç«¯
            let gapiInited = false;
            let gisInited = false;
            //è¼‰å…¥google api
            function gapiLoaded() {
                gapi.load("client", async () => {
                    await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] });
                    gapiInited = true;
                });
            }
            //è¼‰å…¥google OAuthå®¢æˆ¶ç«¯
            function gisLoaded() {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (tokenResponse) => {
                        gapi.client.setToken(tokenResponse);
                        alert("âœ… ç™»å…¥æˆåŠŸï¼");
                    },
                });
                gisInited = true;
            }

            function handleAuthClick() {
                if (!gapiInited || !gisInited) {
                    alert("å°šæœªåˆå§‹åŒ–ï¼Œè«‹ç¨å€™");
                    return;
                }
                tokenClient.requestAccessToken(); //è§¸ç™¼ç™»å…¥æµç¨‹
            }

            async function listPlaylists() {
                //è®€å–æˆ‘çš„æ’­æ”¾æ¸…å–®
                const response = await gapi.client.youtube.playlists.list({
                    part: "snippet,contentDetails", //è«‹æ±‚snippet,contentDetailsè³‡è¨Š
                    mine: true, //è«‹æ±‚æˆ‘çš„æ’­æ”¾æ¸…å–®
                    maxResults: 10, //è«‹æ±‚10å€‹æ’­æ”¾æ¸…å–®
                });

                const playlists = response.result.items; //å–å¾—æ’­æ”¾æ¸…å–®è³‡æ–™
                const list = document.getElementById("playlistList"); //å–å¾—DOMå…ƒç´ 
                list.innerHTML = "";

                if (!playlists || playlists.length === 0) {
                    list.innerHTML = "<li>ğŸ™ æ‰¾ä¸åˆ°ä»»ä½•æ’­æ”¾æ¸…å–®</li>";
                    return;
                }

                playlists.forEach((pl) => {
                    //éæ­·æ¯å€‹æ’­æ”¾æ¸…å–®
                    const li = document.createElement("li");
                    const title = pl.snippet.title; //æ¨™é¡Œ
                    const thumbnail = pl.snippet.thumbnails.default.url; //ç¸®åœ–
                    const id = pl.id; //æ’­æ”¾æ¸…å–®ID

                    //å»ºç«‹åŒ…å«æ‰€åœ–ã€æ¨™é¡Œã€é€£çµçš„ HTML
                    li.innerHTML = `
                        <img src="${thumbnail}" alt="thumb" />
                        <strong>${title}</strong><br>
                        <a href="https://www.youtube.com/playlist?list=${id}" target="_blank">è§€çœ‹æ¸…å–®</a>
                        `;
                    list.appendChild(li); //å°‡æ¸…å–®åŠ å…¥åˆ°è§€çœ‹æ¸…å–®ä¸­
                });
            }

            // åˆå§‹åŒ– script
            window.onload = () => {
                const script1 = document.createElement("script"); //é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
                script1.src = "https://apis.google.com/js/api.js";
                script1.onload = gapiLoaded;
                document.body.appendChild(script1);

                const script2 = document.createElement("script");
                script2.src = "https://accounts.google.com/gsi/client";
                script2.onload = gisLoaded;
                document.body.appendChild(script2);
            };
        </script>
    </body>
</html>
