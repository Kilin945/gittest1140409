<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üéµ Kilin Èü≥Ê®ÇÁ≥ªÁµ± - ÁôªÂÖ•</title>
        <!-- Font Awesome ÂúñÊ®ôÂ∫´ -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <style>
            /* Claude È¢®Ê†ºÂÆåÊï¥ÈáçÁΩÆ */
            *,
            *::before,
            *::after {
                box-sizing: border-box !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Claude È¢®Ê†ºËâ≤ÂΩ©ËÆäÊï∏ */
            :root {
                --claude-bg: #0a0f0d !important;
                --claude-bg-secondary: #0f1512 !important;
                --claude-primary: #d97742 !important;
                --claude-primary-hover: #c56a3a !important;
                --claude-accent: #e08856 !important;
                --claude-text: #ffffff !important;
                --claude-text-secondary: #e5e7eb !important;
                --claude-text-muted: #9ca3af !important;
                --claude-card: rgba(217, 119, 66, 0.08) !important;
                --claude-card-hover: rgba(217, 119, 66, 0.12) !important;
                --claude-border: rgba(217, 119, 66, 0.3) !important;
                --claude-shadow: 0 4px 20px rgba(217, 119, 66, 0.15) !important;
                --claude-shadow-strong: 0 8px 32px rgba(217, 119, 66, 0.25) !important;
                --claude-danger-red: #ef4444 !important;
                --claude-success-green: #22c55e !important;
                --border-radius: 16px !important;
                --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* Âº∑Âà∂Ë¶ÜËìã body Ê®£Âºè */
            html,
            body {
                height: 100% !important;
                background: var(--claude-bg) !important;
                background-image: radial-gradient(circle at 20% 20%, rgba(217, 119, 66, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(224, 136, 86, 0.06) 0%, transparent 50%),
                    linear-gradient(135deg, var(--claude-bg) 0%, var(--claude-bg-secondary) 100%) !important;
                background-attachment: fixed !important;
                color: var(--claude-text) !important;
                font-family: "Inter", "Segoe UI", "ÂæÆËªüÊ≠£ÈªëÈ´î", sans-serif !important;
                overflow: hidden !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* ‰∏ªÂÆπÂô® */
            .login-container {
                height: 100vh !important;
                width: 100% !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                position: relative !important;
                background: transparent !important;
                padding: 20px !important;
            }

            /* ËÉåÊôØÂãïÁï´ */
            .login-container::before {
                content: "" !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: radial-gradient(circle at 15% 25%, rgba(217, 119, 66, 0.1) 0%, transparent 60%),
                    radial-gradient(circle at 85% 75%, rgba(224, 136, 86, 0.08) 0%, transparent 60%) !important;
                z-index: 0 !important;
                animation: backgroundPulse 8s ease-in-out infinite !important;
            }

            @keyframes backgroundPulse {
                0%,
                100% {
                    opacity: 0.3;
                }
                50% {
                    opacity: 0.6;
                }
            }

            /* ÁôªÂÖ•Âç°Áâá */
            .login-card {
                background: var(--claude-card) !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid var(--claude-border) !important;
                border-radius: var(--border-radius) !important;
                padding: 50px 40px !important;
                box-shadow: var(--claude-shadow-strong) !important;
                position: relative !important;
                z-index: 1 !important;
                width: 100% !important;
                max-width: 450px !important;
                overflow: hidden !important;
                animation: cardSlideIn 0.8s ease-out !important;
            }

            .login-card::before {
                content: "" !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: linear-gradient(
                    45deg,
                    transparent 0%,
                    rgba(217, 119, 66, 0.03) 50%,
                    transparent 100%
                ) !important;
                z-index: 0 !important;
            }

            .login-content {
                position: relative !important;
                z-index: 1 !important;
            }

            @keyframes cardSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(50px) scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            /* ÁôªÂÖ•Ê®ôÈ°å */
            .login-header {
                text-align: center !important;
                margin: 0 0 40px 0 !important;
            }

            .login-title {
                font-size: 2.2rem !important;
                font-weight: 700 !important;
                color: var(--claude-text) !important;
                margin: 0 0 10px 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 15px !important;
                font-family: inherit !important;
            }

            .login-title i {
                color: var(--claude-primary) !important;
                font-size: 2.5rem !important;
                animation: iconBounce 2s ease-in-out infinite !important;
            }

            @keyframes iconBounce {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-8px);
                }
            }

            .login-subtitle {
                font-size: 1.1rem !important;
                color: var(--claude-text-muted) !important;
                margin: 0 !important;
                font-family: inherit !important;
            }

            /* Ë°®ÂñÆÊ®£Âºè */
            .login-form {
                display: flex !important;
                flex-direction: column !important;
                gap: 25px !important;
            }

            .form-group {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
            }

            .form-label {
                font-size: 1rem !important;
                font-weight: 600 !important;
                color: var(--claude-text-secondary) !important;
                margin: 0 !important;
                font-family: inherit !important;
            }

            .form-input {
                width: 100% !important;
                padding: 16px 20px !important;
                border: 2px solid var(--claude-border) !important;
                border-radius: var(--border-radius) !important;
                background: var(--claude-bg-secondary) !important;
                color: var(--claude-text) !important;
                font-size: 1rem !important;
                transition: var(--transition) !important;
                font-family: inherit !important;
                outline: none !important;
            }

            .form-input::placeholder {
                color: var(--claude-text-muted) !important;
            }

            .form-input:focus {
                border-color: var(--claude-primary) !important;
                box-shadow: 0 0 0 4px rgba(217, 119, 66, 0.2) !important;
                background: var(--claude-bg) !important;
            }

            /* ÂØÜÁ¢ºËº∏ÂÖ•Ê°ÜÁâπÊÆäÊ®£Âºè */
            .password-input {
                position: relative !important;
            }

            .password-toggle {
                position: absolute !important;
                right: 15px !important;
                top: 50% !important;
                transform: translateY(-50%) !important;
                background: none !important;
                border: none !important;
                color: var(--claude-text-muted) !important;
                cursor: pointer !important;
                font-size: 1.1rem !important;
                transition: var(--transition) !important;
                padding: 5px !important;
            }

            .password-toggle:hover {
                color: var(--claude-primary) !important;
            }

            /* ÁôªÂÖ•ÊåâÈàï */
            .login-btn {
                width: 100% !important;
                padding: 18px 25px !important;
                background: linear-gradient(135deg, var(--claude-primary), var(--claude-accent)) !important;
                color: white !important;
                border: none !important;
                border-radius: var(--border-radius) !important;
                font-size: 1.1rem !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                transition: var(--transition) !important;
                box-shadow: var(--claude-shadow) !important;
                position: relative !important;
                overflow: hidden !important;
                font-family: inherit !important;
                outline: none !important;
                margin: 10px 0 0 0 !important;
            }

            .login-btn::before {
                content: "" !important;
                position: absolute !important;
                top: 0 !important;
                left: -100% !important;
                width: 100% !important;
                height: 100% !important;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent) !important;
                transition: left 0.6s !important;
            }

            .login-btn:hover {
                background: linear-gradient(135deg, var(--claude-primary-hover), var(--claude-primary)) !important;
                transform: translateY(-2px) !important;
                box-shadow: var(--claude-shadow-strong) !important;
            }

            .login-btn:hover::before {
                left: 100% !important;
            }

            .login-btn:active {
                transform: translateY(0) !important;
            }

            .login-btn:disabled {
                background: #666 !important;
                cursor: not-allowed !important;
                transform: none !important;
            }

            /* ÈåØË™§Ë®äÊÅØ */
            .error-message {
                background: rgba(239, 68, 68, 0.1) !important;
                border: 1px solid rgba(239, 68, 68, 0.3) !important;
                color: #fca5a5 !important;
                padding: 15px 20px !important;
                border-radius: var(--border-radius) !important;
                font-size: 0.95rem !important;
                font-weight: 500 !important;
                margin: 15px 0 0 0 !important;
                display: none !important;
                align-items: center !important;
                gap: 10px !important;
                backdrop-filter: blur(10px) !important;
                animation: errorSlideIn 0.3s ease-out !important;
                font-family: inherit !important;
            }

            .error-message.show {
                display: flex !important;
            }

            @keyframes errorSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .error-message i {
                font-size: 1.1rem !important;
                color: var(--claude-danger-red) !important;
            }

            /* ËºâÂÖ•ÁãÄÊÖã */
            .loading {
                display: none !important;
                align-items: center !important;
                gap: 10px !important;
                color: var(--claude-text-muted) !important;
                font-size: 0.95rem !important;
                margin: 10px 0 0 0 !important;
                font-family: inherit !important;
            }

            .loading.show {
                display: flex !important;
            }

            .loading i {
                animation: spin 1s linear infinite !important;
                color: var(--claude-primary) !important;
            }

            @keyframes spin {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            /* ËøîÂõûÈ¶ñÈ†ÅÈÄ£Áµê */
            .back-link {
                text-align: center !important;
                margin: 30px 0 0 0 !important;
            }

            .back-link a {
                color: var(--claude-text-muted) !important;
                text-decoration: none !important;
                font-size: 0.95rem !important;
                transition: var(--transition) !important;
                display: inline-flex !important;
                align-items: center !important;
                gap: 8px !important;
                font-family: inherit !important;
            }

            .back-link a:hover {
                color: var(--claude-primary) !important;
                transform: translateX(-5px) !important;
            }

            /* ÈüøÊáâÂºèË®≠Ë®à */
            @media (max-width: 768px) {
                .login-container {
                    padding: 15px !important;
                }

                .login-card {
                    padding: 40px 30px !important;
                    max-width: 100% !important;
                }

                .login-title {
                    font-size: 2rem !important;
                    flex-direction: column !important;
                    gap: 10px !important;
                }

                .login-title i {
                    font-size: 2.2rem !important;
                }

                .form-input {
                    padding: 14px 18px !important;
                    font-size: 0.95rem !important;
                }

                .login-btn {
                    padding: 16px 22px !important;
                    font-size: 1rem !important;
                }
            }

            @media (max-width: 480px) {
                .login-card {
                    padding: 35px 25px !important;
                }

                .login-title {
                    font-size: 1.8rem !important;
                }

                .form-input {
                    padding: 12px 16px !important;
                }
            }

            /* Êñ∞Â¢ûÁöÑ CSS Ê®£Âºè */
            .guest-section {
                margin: 20px 0 0 0 !important;
            }

            .divider {
                text-align: center !important;
                margin: 20px 0 !important;
                position: relative !important;
            }

            .divider::before {
                content: "" !important;
                position: absolute !important;
                top: 50% !important;
                left: 0 !important;
                right: 0 !important;
                height: 1px !important;
                background: var(--claude-border) !important;
            }

            .divider span {
                background: var(--claude-bg) !important;
                padding: 0 15px !important;
                color: var(--claude-text-muted) !important;
                font-size: 0.9rem !important;
                position: relative !important;
            }

            .guest-btn {
                width: 100% !important;
                padding: 16px 25px !important;
                background: linear-gradient(135deg, #6c757d, #495057) !important;
                color: white !important;
                border: none !important;
                border-radius: var(--border-radius) !important;
                font-size: 1rem !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                transition: var(--transition) !important;
                box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3) !important;
                font-family: inherit !important;
                outline: none !important;
            }

            .guest-btn:hover {
                background: linear-gradient(135deg, #5a6268, #495057) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4) !important;
            }

            .guest-btn:active {
                transform: translateY(0) !important;
            }
        </style>
    </head>

    <body>
        <div class="login-container">
            <div class="login-card">
                <div class="login-content">
                    <div class="login-header">
                        <h1 class="login-title">
                            <i class="fas fa-music"></i>
                            Kilin Èü≥Ê®ÇÁ≥ªÁµ±
                        </h1>
                        <p class="login-subtitle">Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂ∏≥ËôüÂØÜÁ¢º‰ª•ÈÄ≤ÂÖ•Èü≥Ê®Ç‰∏ñÁïå</p>
                    </div>

                    <form class="login-form" id="loginForm">
                        <div class="form-group">
                            <label class="form-label" for="username"> <i class="fas fa-user"></i> ‰ΩøÁî®ËÄÖÂêçÁ®± </label>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                class="form-input"
                                placeholder="Ë´ãËº∏ÂÖ•‰ΩøÁî®ËÄÖÂêçÁ®±"
                                required
                                autocomplete="username"
                            />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password"> <i class="fas fa-lock"></i> ÂØÜÁ¢º </label>
                            <div class="password-input">
                                <input
                                    type="password"
                                    id="password"
                                    name="password"
                                    class="form-input"
                                    placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º"
                                    required
                                    autocomplete="current-password"
                                />
                                <button type="button" class="password-toggle" onclick="togglePassword()">
                                    <i class="fas fa-eye" id="passwordIcon"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Âú®ÁôªÂÖ•ÊåâÈàïÂæåÈù¢Êñ∞Â¢ûÈÄôÊÆµ HTML -->
                        <div class="guest-section">
                            <div class="divider">
                                <span>Êàñ</span>
                            </div>
                            <button type="button" class="guest-btn" id="guestBtn" onclick="handleGuestLogin()">
                                <i class="fas fa-user-secret"></i>
                                ‰ª•ÈÅäÂÆ¢Ë∫´ÂàÜÁÄèË¶Ω
                            </button>
                        </div>

                        <button type="submit" class="login-btn" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            ÈÄ≤ÂÖ•Èü≥Ê®ÇÁ≥ªÁµ±
                        </button>

                        <div class="loading" id="loadingMessage">
                            <i class="fas fa-spinner"></i>
                            Ê≠£Âú®È©óË≠âÁôªÂÖ•Ë≥áË®ä...
                        </div>

                        <div class="error-message" id="errorMessage">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="errorText">ÈåØË™§Ë®äÊÅØ</span>
                        </div>
                    </form>

                    <div class="back-link">
                        <a href="index.html">
                            <i class="fas fa-arrow-left"></i>
                            ËøîÂõûÂÄã‰∫∫È¶ñÈ†Å
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            console.log("üéµ Kilin Èü≥Ê®ÇÁ≥ªÁµ±ÁôªÂÖ•È†ÅÈù¢ËºâÂÖ•ÂÆåÊàê");

            // ÂãïÊÖãË®≠ÂÆö API Base URL
            const currentHostname = window.location.hostname;
            const currentOrigin = window.location.origin;

            let API_BASE;
            if (currentHostname.includes("github.io")) {
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("‚òÅÔ∏è GitHub Pages Áí∞Â¢É");
            } else if (currentHostname === "localhost" || currentHostname === "127.0.0.1") {
                API_BASE = "http://localhost:8000/api";
                console.log("üè† Êú¨Âú∞ÈñãÁôºÁí∞Â¢É");
            } else if (currentHostname.includes("railway.app")) {
                API_BASE = currentOrigin + "/api";
                console.log("üöÇ Railway Áí∞Â¢É");
            } else {
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("üåê È†êË®≠Áí∞Â¢É");
            }

            console.log("üì° API_BASE:", API_BASE);

            // ÂØÜÁ¢ºÈ°ØÁ§∫/Èö±ËóèÂàáÊèõ
            function togglePassword() {
                const passwordInput = document.getElementById("password");
                const passwordIcon = document.getElementById("passwordIcon");

                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    passwordIcon.className = "fas fa-eye-slash";
                } else {
                    passwordInput.type = "password";
                    passwordIcon.className = "fas fa-eye";
                }
            }

            // È°ØÁ§∫ÈåØË™§Ë®äÊÅØ
            function showError(message) {
                const errorMessage = document.getElementById("errorMessage");
                const errorText = document.getElementById("errorText");
                errorText.textContent = message;
                errorMessage.classList.add("show");

                // 3ÁßíÂæåËá™ÂãïÈö±Ëóè
                setTimeout(() => {
                    errorMessage.classList.remove("show");
                }, 3000);
            }

            // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
            function showLoading(show = true) {
                const loadingMessage = document.getElementById("loadingMessage");
                const loginBtn = document.getElementById("loginBtn");

                if (show) {
                    loadingMessage.classList.add("show");
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> È©óË≠â‰∏≠...';
                } else {
                    loadingMessage.classList.remove("show");
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ÈÄ≤ÂÖ•Èü≥Ê®ÇÁ≥ªÁµ±';
                }
            }

            // È©óË≠â‰ΩøÁî®ËÄÖ
            async function validateUser(username, password) {
                try {
                    console.log("üîç ÈñãÂßãÈ©óË≠â‰ΩøÁî®ËÄÖ:", username);

                    // Ê™¢Êü•ÂØÜÁ¢ºÊòØÂê¶ÁÇ∫ "super"
                    if (password !== "super") {
                        throw new Error("ÂØÜÁ¢ºÈåØË™§ÔºÅ(Ë´ã‰ΩøÁî® 'super' ‰ΩúÁÇ∫ÂØÜÁ¢º)");
                    }

                    // ÂæûË≥áÊñôÂ∫´Êü•Ë©¢‰ΩøÁî®ËÄÖ
                    const response = await fetch(`${API_BASE}/users`);
                    if (!response.ok) {
                        throw new Error(`ÁÑ°Ê≥ïÈÄ£Êé•‰º∫ÊúçÂô® (${response.status})`);
                    }

                    const users = await response.json();
                    console.log("üìä ÂèñÂæó‰ΩøÁî®ËÄÖË≥áÊñôÔºåÂÖ±", users.length, "‰Ωç‰ΩøÁî®ËÄÖ");

                    // Êü•Êâæ‰ΩøÁî®ËÄÖ
                    const user = users.find((u) => u.user_name === username);
                    if (!user) {
                        throw new Error("Êâæ‰∏çÂà∞Ê≠§‰ΩøÁî®ËÄÖÔºÅË´ãÊ™¢Êü•‰ΩøÁî®ËÄÖÂêçÁ®±ÊòØÂê¶Ê≠£Á¢∫");
                    }

                    console.log("‚úÖ ‰ΩøÁî®ËÄÖÈ©óË≠âÊàêÂäü:", user);
                    return user;
                } catch (error) {
                    console.error("‚ùå ‰ΩøÁî®ËÄÖÈ©óË≠âÂ§±Êïó:", error);
                    throw error;
                }
            }

            // Êõ¥Êñ∞‰ΩøÁî®ËÄÖ‰ΩøÁî®ÊôÇÈñìÔºàÁôªÂÖ•ÊôÇÂ¢ûÂä†30ÁßíÔºâ
            async function updateUserLoginTime(user) {
                try {
                    console.log("‚è∞ Êõ¥Êñ∞‰ΩøÁî®ËÄÖÁôªÂÖ•ÊôÇÈñì:", user.user_name);

                    const updateData = {
                        table: "users",
                        user_id: parseInt(user.user_id),
                        user_name: user.user_name,
                        password: user.password,
                        usage_time: "00:00:30", // Â¢ûÂä†30Áßí‰ΩøÁî®ÊôÇÈñì
                        state: user.state || 0,
                    };

                    const response = await fetch(`${API_BASE}/2/update`, {
                        method: "POST",
                        mode: "cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(updateData),
                    });

                    if (response.ok) {
                        console.log("‚úÖ ‰ΩøÁî®ËÄÖÁôªÂÖ•ÊôÇÈñìÊõ¥Êñ∞ÊàêÂäü");
                    } else {
                        console.warn("‚ö†Ô∏è ‰ΩøÁî®ËÄÖÁôªÂÖ•ÊôÇÈñìÊõ¥Êñ∞Â§±ÊïóÔºå‰ΩÜÁπºÁ∫åÁôªÂÖ•ÊµÅÁ®ã");
                    }
                } catch (error) {
                    console.warn("‚ö†Ô∏è Êõ¥Êñ∞‰ΩøÁî®ËÄÖÁôªÂÖ•ÊôÇÈñìÊôÇÁôºÁîüÈåØË™§:", error);
                    // ‰∏çÈòªÊìãÁôªÂÖ•ÊµÅÁ®ãÔºåÂè™ÊòØË≠¶Âëä
                }
            }

            // Êñ∞Â¢ûÈÅäÂÆ¢ÁôªÂÖ•ËôïÁêÜÂáΩÊï∏
            function handleGuestLogin() {
                console.log("üë§ ‰ΩøÁî®ËÄÖÈÅ∏ÊìáÈÅäÂÆ¢Ê®°Âºè");

                // Ë®≠ÂÆöÈÅäÂÆ¢ÊúÉË©±
                const guestInfo = {
                    user_name: "ÈÅäÂÆ¢",
                    login_time: new Date().toISOString(),
                    is_guest: true,
                };

                localStorage.setItem("kilin_guest_session", JSON.stringify(guestInfo));

                // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
                const guestBtn = document.getElementById("guestBtn");
                guestBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÈÄ≤ÂÖ•ÈÅäÂÆ¢Ê®°Âºè...';
                guestBtn.disabled = true;

                // Âª∂ÈÅ≤Ë∑≥ËΩâ
                setTimeout(() => {
                    console.log("üéµ Ë∑≥ËΩâÂà∞Èü≥Ê®ÇÁ≥ªÁµ±ÔºàÈÅäÂÆ¢Ê®°ÂºèÔºâ");
                    window.location.href = "sidebar.html";
                }, 1000);
            }

            // ËôïÁêÜÁôªÂÖ•Ë°®ÂñÆÊèê‰∫§
            document.getElementById("loginForm").addEventListener("submit", async function (e) {
                e.preventDefault();

                const username = document.getElementById("username").value.trim();
                const password = document.getElementById("password").value;

                // Âü∫Êú¨È©óË≠â
                if (!username || !password) {
                    showError("Ë´ãËº∏ÂÖ•ÂÆåÊï¥ÁöÑÂ∏≥ËôüÂØÜÁ¢ºË≥áË®ä");
                    return;
                }

                showLoading(true);

                try {
                    // È©óË≠â‰ΩøÁî®ËÄÖ
                    const user = await validateUser(username, password);

                    // Êõ¥Êñ∞‰ΩøÁî®ËÄÖÁôªÂÖ•ÊôÇÈñì
                    await updateUserLoginTime(user);

                    // ÂÑ≤Â≠ò‰ΩøÁî®ËÄÖË≥áË®äÂà∞ localStorageÔºàÁî®ÊñºÂú®Èü≥Ê®ÇÁ≥ªÁµ±‰∏≠È°ØÁ§∫Ê≠°ËøéË®äÊÅØÔºâ
                    const userInfo = {
                        user_id: user.user_id,
                        user_name: user.user_name,
                        login_time: new Date().toISOString(),
                        session_id: Date.now(), // Á∞°ÂñÆÁöÑÊúÉË©±Ê®ôË≠ò
                    };

                    localStorage.setItem("kilin_user_session", JSON.stringify(userInfo));
                    console.log("üíæ ‰ΩøÁî®ËÄÖÊúÉË©±Ë≥áË®äÂ∑≤ÂÑ≤Â≠ò");

                    // ÁôªÂÖ•ÊàêÂäüÔºåÂª∂ÈÅ≤Ë∑≥ËΩâ‰ª•È°ØÁ§∫ÊàêÂäüÁãÄÊÖã
                    showLoading(false);
                    document.getElementById("loginBtn").innerHTML = '<i class="fas fa-check"></i> ÁôªÂÖ•ÊàêÂäüÔºÅ';
                    document.getElementById("loginBtn").style.background = "linear-gradient(135deg, #22c55e, #16a34a)";

                    setTimeout(() => {
                        console.log("üéµ Ë∑≥ËΩâÂà∞Èü≥Ê®ÇÁ≥ªÁµ±");
                        window.location.href = "sidebar.html";
                    }, 1500);
                } catch (error) {
                    showLoading(false);
                    showError(error.message);
                    console.error("‚ùå ÁôªÂÖ•Â§±Êïó:", error);
                }
            });

            // È†ÅÈù¢ËºâÂÖ•ÊôÇÊ™¢Êü•ÊòØÂê¶Â∑≤ÁôªÂÖ•
            document.addEventListener("DOMContentLoaded", function () {
                const existingSession = localStorage.getItem("kilin_user_session");
                if (existingSession) {
                    try {
                        const userInfo = JSON.parse(existingSession);
                        console.log("üîç ÁôºÁèæÁèæÊúâÊúÉË©±:", userInfo.user_name);

                        // ÂèØ‰ª•ÈÅ∏ÊìáÊòØÂê¶Ëá™ÂãïË∑≥ËΩâÊàñË©¢Âïè‰ΩøÁî®ËÄÖ
                        if (confirm(`Ê™¢Ê∏¨Âà∞ÊÇ®Â∑≤ÁôªÂÖ•ÁÇ∫ ${userInfo.user_name}ÔºåÊòØÂê¶Áõ¥Êé•ÈÄ≤ÂÖ•Èü≥Ê®ÇÁ≥ªÁµ±Ôºü`)) {
                            window.location.href = "sidebar.html";
                            return;
                        } else {
                            // Ê∏ÖÈô§ÊúÉË©±ÔºåÈáçÊñ∞ÁôªÂÖ•
                            localStorage.removeItem("kilin_user_session");
                        }
                    } catch (error) {
                        console.warn("‚ö†Ô∏è ÊúÉË©±Ë≥áÊñôÁÑ°ÊïàÔºåÊ∏ÖÈô§‰∏¶ÈáçÊñ∞ÁôªÂÖ•");
                        localStorage.removeItem("kilin_user_session");
                    }
                }

                // Ëá™ÂãïËÅöÁÑ¶Âà∞‰ΩøÁî®ËÄÖÂêçÁ®±Ëº∏ÂÖ•Ê°Ü
                document.getElementById("username").focus();
            });

            // ÈçµÁõ§Âø´Êç∑ÈçµÊîØÊè¥
            document.addEventListener("keydown", function (e) {
                // ESC ÈçµÊ∏ÖÈô§Ë°®ÂñÆ
                if (e.key === "Escape") {
                    document.getElementById("loginForm").reset();
                    document.getElementById("username").focus();
                }
            });

            console.log("üîê ÁôªÂÖ•Á≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê");
        </script>
    </body>
</html>
