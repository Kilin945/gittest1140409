<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <title>æ–°å¢æ­Œæ‰‹è¡¨å–®</title>
        <!-- Font Awesome åœ–æ¨™åº« -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <link rel="stylesheet" href="main.css" />
        <style>
            .required {
                color: red;
            }

            .form-hint {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
                font-style: italic;
            }
        </style>
    </head>
    <body>
        <h2>ğŸ¤ æ–°å¢æ­Œæ‰‹</h2>

        <label for="name">æ­Œæ‰‹åç¨± <span class="required">*</span></label>
        <input type="text" id="name" name="artist_name" placeholder="è«‹è¼¸å…¥æ­Œæ‰‹å§“å" required />

        <label for="gender">æ€§åˆ¥ <span class="required">*</span></label>
        <select id="gender" required>
            <option value="">è«‹é¸æ“‡æ€§åˆ¥</option>
            <option value="M">ç”·</option>
            <option value="F">å¥³</option>
            <option value="other">å…¶ä»–</option>
        </select>

        <label for="country">åœ‹å®¶/åœ°å€</label>
        <select id="country">
            <option value="">è«‹é¸æ“‡åœ‹å®¶/åœ°å€</option>
            <option value="TW">è‡ºç£</option>
            <option value="HK">é¦™æ¸¯</option>
            <option value="JP">æ—¥æœ¬</option>
            <option value="MY">é¦¬ä¾†è¥¿äº</option>
            <option value="CN">ä¸­åœ‹</option>
            <option value="US">ç¾åœ‹</option>
            <option value="SG">æ–°åŠ å¡</option>
            <option value="KR">éŸ“åœ‹</option>
            <option value="other">å…¶ä»–</option>
        </select>
        <div class="form-hint">åœ‹å®¶/åœ°å€ç‚ºé¸å¡«é …ç›®</div>

        <button>æ–°å¢æ­Œæ‰‹</button>

        <script>
            console.log("Insert Artist Script é–‹å§‹åŸ·è¡Œ");

            // ğŸ”§ å‹•æ…‹è¨­å®š API Base URL - ä¿®æ­£ç¡¬ç·¨ç¢¼å•é¡Œ
            const currentHostname = window.location.hostname;
            const currentOrigin = window.location.origin;

            let API_BASE;
            if (currentHostname.includes("github.io")) {
                // GitHub Pages ç’°å¢ƒ
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("â˜ï¸ GitHub Pages ç’°å¢ƒï¼Œä½¿ç”¨ Railway å¾Œç«¯");
            } else if (currentHostname === "localhost" || currentHostname === "127.0.0.1") {
                // æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
                API_BASE = "http://localhost:8000/api";
                console.log("ğŸ  æœ¬åœ°é–‹ç™¼ç’°å¢ƒ");
            } else if (currentHostname.includes("railway.app")) {
                // ç›´æ¥è¨ªå• Railway æ‡‰ç”¨
                API_BASE = currentOrigin + "/api";
                console.log("ğŸš‚ Railway ç’°å¢ƒï¼Œä½¿ç”¨ç›¸å°è·¯å¾‘");
            } else {
                // å…¶ä»–ç’°å¢ƒï¼Œé è¨­ä½¿ç”¨ Railway
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("ğŸŒ æœªçŸ¥ç’°å¢ƒï¼Œé è¨­ä½¿ç”¨ Railway å¾Œç«¯");
            }
            console.log("ğŸ“¡ Insert Artist API_BASE:", API_BASE);

            // æ–°å¢æ­Œæ‰‹å‡½æ•¸
            window.insertpost = async function () {
                try {
                    // å–å¾—è¡¨å–®è³‡æ–™ä¸¦é€²è¡Œé©—è­‰
                    let name = document.getElementById("name").value.trim();
                    let gender = document.getElementById("gender").value;
                    let country = document.getElementById("country").value;
                    let state = "0";

                    console.log("=== æ¬„ä½å€¼æª¢æŸ¥ ===");
                    console.log("name:", `'${name}'`);
                    console.log("gender:", `'${gender}'`);
                    console.log("country:", `'${country}'`);
                    console.log("state:", `'${state}'`);

                    // æª¢æŸ¥å¿…å¡«æ¬„ä½
                    if (!name) {
                        alert("è«‹è¼¸å…¥æ­Œæ‰‹åç¨±ï¼");
                        document.getElementById("name").focus();
                        return;
                    }

                    if (!gender) {
                        alert("è«‹é¸æ“‡æ€§åˆ¥ï¼");
                        document.getElementById("gender").focus();
                        return;
                    }

                    console.log("ğŸ“¤ æäº¤è³‡æ–™:", { name, gender, country, state });
                    console.log("ä½¿ç”¨ API ç«¯é»:", `${API_BASE}/2/insert`);

                    const response = await fetch(`${API_BASE}/2/insert`, {
                        method: "POST",
                        mode: "cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            table: "artists",
                            artist_name: name,
                            gender: gender,
                            country: country || "", // å¦‚æœæ²’é¸æ“‡åœ‹å®¶ï¼Œå‚³é€ç©ºå­—ä¸²
                            state: state,
                        }),
                    });

                    console.log("Response Status:", response.status);

                    if (response.ok) {
                        // å–å¾—æ€§åˆ¥é¡¯ç¤ºæ–‡å­—
                        const genderText =
                            {
                                M: "ç”·",
                                F: "å¥³",
                                other: "å…¶ä»–",
                            }[gender] || gender;

                        // å–å¾—åœ‹å®¶é¡¯ç¤ºæ–‡å­—
                        const countryOptions = {
                            TW: "è‡ºç£",
                            HK: "é¦™æ¸¯",
                            JP: "æ—¥æœ¬",
                            MY: "é¦¬ä¾†è¥¿äº",
                            CN: "ä¸­åœ‹",
                            US: "ç¾åœ‹",
                            SG: "æ–°åŠ å¡",
                            KR: "éŸ“åœ‹",
                            other: "å…¶ä»–",
                        };
                        const countryText = country ? countryOptions[country] || country : "æœªå¡«å¯«";

                        // å‰µå»ºæˆåŠŸè¨Šæ¯
                        const successMessage = `âœ… æ­Œæ‰‹æ–°å¢æˆåŠŸï¼
ğŸ¤ æ­Œæ‰‹åç¨±: ${name}
ğŸ‘¤ æ€§åˆ¥: ${genderText}
ğŸŒ åœ‹å®¶/åœ°å€: ${countryText}`;

                        alert(successMessage);
                        console.log("âœ… æ­Œæ‰‹æ–°å¢æˆåŠŸ");

                        // æ¸…ç©ºè¡¨å–®
                        document.getElementById("name").value = "";
                        document.getElementById("gender").value = "";
                        document.getElementById("country").value = "";
                        document.getElementById("name").focus(); // ç„¦é»å›åˆ°ç¬¬ä¸€å€‹æ¬„ä½
                    } else {
                        const errorText = await response.text();
                        console.error("âŒ æ–°å¢å¤±æ•—:", response.status, errorText);
                        alert(`âŒ æ–°å¢å¤±æ•—: ${errorText}`);
                    }
                } catch (error) {
                    console.error("âŒ è«‹æ±‚éŒ¯èª¤:", error);
                    alert(`âŒ æ–°å¢å¤±æ•—: ${error.message}`);
                }
            };

            console.log("DOM è¼‰å…¥å®Œæˆ");
            const btn = document.querySelector("button");
            console.log("æ‰¾åˆ°æŒ‰éˆ•:", btn);
            if (btn) {
                btn.addEventListener("click", function () {
                    console.log("æŒ‰éˆ•é»æ“Šäº‹ä»¶è§¸ç™¼");
                    window.insertpost();
                });
                console.log("âœ… äº‹ä»¶ç›£è½å™¨å·²ç¶å®š");
            } else {
                console.error("âŒ æ‰¾ä¸åˆ°æ–°å¢æ­Œæ‰‹æŒ‰éˆ•");
            }

            console.log("Script åŸ·è¡Œå®Œç•¢");
        </script>
    </body>
</html>
