<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>å€‹äººè¨­å®š - Kilin éŸ³æ¨‚ç³»çµ±</title>
        <!-- Font Awesome åœ–æ¨™åº« -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

        <style>
            /* Claude é¢¨æ ¼å®Œæ•´é‡ç½® */
            *,
            *::before,
            *::after {
                box-sizing: border-box !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Claude é¢¨æ ¼è‰²å½©è®Šæ•¸ */
            :root {
                --claude-bg: #0a0f0d !important;
                --claude-bg-secondary: #0f1512 !important;
                --claude-primary: #d97742 !important;
                --claude-primary-hover: #c56a3a !important;
                --claude-accent: #e08856 !important;
                --claude-text: #ffffff !important;
                --claude-text-secondary: #e5e7eb !important;
                --claude-text-muted: #9ca3af !important;
                --claude-card: rgba(217, 119, 66, 0.08) !important;
                --claude-card-hover: rgba(217, 119, 66, 0.12) !important;
                --claude-border: rgba(217, 119, 66, 0.3) !important;
                --claude-shadow: 0 4px 20px rgba(217, 119, 66, 0.15) !important;
                --claude-shadow-strong: 0 8px 32px rgba(217, 119, 66, 0.25) !important;
                --claude-success-green: #22c55e !important;
                --claude-danger-red: #ef4444 !important;
                --border-radius: 16px !important;
                --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* åŸºç¤æ¨£å¼ */
            body {
                background: var(--claude-bg) !important;
                background-image: radial-gradient(circle at 20% 20%, rgba(217, 119, 66, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(224, 136, 86, 0.06) 0%, transparent 50%),
                    linear-gradient(135deg, var(--claude-bg) 0%, var(--claude-bg-secondary) 100%) !important;
                background-attachment: fixed !important;
                color: var(--claude-text) !important;
                font-family: "Inter", "Segoe UI", "å¾®è»Ÿæ­£é»‘é«”", sans-serif !important;
                line-height: 1.6 !important;
                min-height: 100vh !important;
                padding: 20px !important;
            }

            .settings-container {
                max-width: 800px !important;
                margin: 0 auto !important;
                padding: 0 !important;
            }

            /* é é¢æ¨™é¡Œ */
            .settings-header {
                text-align: center !important;
                margin: 0 0 40px 0 !important;
                padding: 30px 20px !important;
                background: var(--claude-card) !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid var(--claude-border) !important;
                border-radius: var(--border-radius) !important;
                box-shadow: var(--claude-shadow) !important;
                position: relative !important;
                overflow: hidden !important;
            }

            .settings-header::before {
                content: "" !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: linear-gradient(
                    45deg,
                    transparent 0%,
                    rgba(217, 119, 66, 0.02) 50%,
                    transparent 100%
                ) !important;
                z-index: 0 !important;
            }

            .settings-header-content {
                position: relative !important;
                z-index: 1 !important;
            }

            .settings-title {
                font-size: 2.5rem !important;
                font-weight: 700 !important;
                color: var(--claude-text) !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 15px !important;
                margin: 0 0 10px 0 !important;
                font-family: inherit !important;
            }

            .settings-title i {
                color: var(--claude-primary) !important;
                font-size: 2.2rem !important;
            }

            .settings-subtitle {
                color: var(--claude-text-muted) !important;
                font-size: 1.1rem !important;
                margin: 0 !important;
            }

            /* ä¸»è¦è¨­å®šå¡ç‰‡ */
            .settings-card {
                background: var(--claude-card) !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid var(--claude-border) !important;
                border-radius: var(--border-radius) !important;
                padding: 40px !important;
                box-shadow: var(--claude-shadow-strong) !important;
                position: relative !important;
                overflow: hidden !important;
                animation: fadeInUp 0.6s ease-out !important;
            }

            .settings-card::before {
                content: "" !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: linear-gradient(
                    45deg,
                    transparent 0%,
                    rgba(217, 119, 66, 0.02) 50%,
                    transparent 100%
                ) !important;
                z-index: 0 !important;
            }

            .settings-content {
                position: relative !important;
                z-index: 1 !important;
            }

            /* ä½¿ç”¨è€…è³‡è¨Šå€å¡Š */
            .user-info {
                background: var(--claude-primary) !important;
                color: white !important;
                padding: 25px !important;
                border-radius: var(--border-radius) !important;
                margin: 0 0 30px 0 !important;
                text-align: center !important;
                box-shadow: var(--claude-shadow) !important;
            }

            .user-avatar {
                width: 80px !important;
                height: 80px !important;
                background: rgba(255, 255, 255, 0.2) !important;
                border-radius: 50% !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                margin: 0 auto 15px auto !important;
                font-size: 2rem !important;
            }

            .user-name {
                font-size: 1.4rem !important;
                font-weight: 700 !important;
                margin: 0 0 5px 0 !important;
            }

            .user-id {
                font-size: 0.9rem !important;
                opacity: 0.8 !important;
                margin: 0 !important;
            }

            /* è¡¨å–®æ¨£å¼ */
            .settings-form {
                display: flex !important;
                flex-direction: column !important;
                gap: 25px !important;
            }

            .form-group {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
            }

            .form-label {
                font-size: 1rem !important;
                font-weight: 600 !important;
                color: var(--claude-text-secondary) !important;
                display: flex !important;
                align-items: center !important;
                gap: 8px !important;
                margin: 0 !important;
                font-family: inherit !important;
            }

            .form-input,
            .form-select {
                width: 100% !important;
                padding: 16px 20px !important;
                border: 2px solid var(--claude-border) !important;
                border-radius: var(--border-radius) !important;
                background: var(--claude-bg-secondary) !important;
                color: var(--claude-text) !important;
                font-size: 1rem !important;
                transition: var(--transition) !important;
                font-family: inherit !important;
                outline: none !important;
            }

            .form-input::placeholder {
                color: var(--claude-text-muted) !important;
            }

            .form-input:focus,
            .form-select:focus {
                border-color: var(--claude-primary) !important;
                box-shadow: 0 0 0 4px rgba(217, 119, 66, 0.2) !important;
                background: var(--claude-bg) !important;
            }

            .form-input:disabled {
                background: rgba(255, 255, 255, 0.05) !important;
                color: var(--claude-text-muted) !important;
                cursor: not-allowed !important;
            }

            /* æŒ‰éˆ•æ¨£å¼ */
            .btn-group {
                display: flex !important;
                gap: 15px !important;
                margin: 20px 0 0 0 !important;
                flex-wrap: wrap !important;
            }

            .settings-btn {
                padding: 16px 30px !important;
                border: none !important;
                border-radius: var(--border-radius) !important;
                font-size: 1rem !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                transition: var(--transition) !important;
                display: flex !important;
                align-items: center !important;
                gap: 10px !important;
                flex: 1 !important;
                min-width: 150px !important;
                justify-content: center !important;
                font-family: inherit !important;
                outline: none !important;
            }

            .btn-save {
                background: linear-gradient(135deg, var(--claude-success-green), #16a34a) !important;
                color: white !important;
                box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3) !important;
            }

            .btn-save:hover {
                background: linear-gradient(135deg, #16a34a, #15803d) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4) !important;
            }

            .btn-reset {
                background: linear-gradient(135deg, var(--claude-text-muted), #6b7280) !important;
                color: white !important;
                box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3) !important;
            }

            .btn-reset:hover {
                background: linear-gradient(135deg, #6b7280, #4b5563) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4) !important;
            }

            .btn-delete {
                background: linear-gradient(135deg, var(--claude-danger-red), #dc2626) !important;
                color: white !important;
                box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3) !important;
            }

            .btn-delete:hover {
                background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4) !important;
            }

            .settings-btn:disabled {
                background: #666 !important;
                cursor: not-allowed !important;
                transform: none !important;
                opacity: 0.6 !important;
            }

            /* å¯†ç¢¼è¼¸å…¥æ¡†ç‰¹æ®Šæ¨£å¼ */
            .password-group {
                position: relative !important;
            }

            .password-toggle {
                position: absolute !important;
                right: 15px !important;
                top: 50% !important;
                transform: translateY(-50%) !important;
                background: none !important;
                border: none !important;
                color: var(--claude-text-muted) !important;
                cursor: pointer !important;
                font-size: 1.1rem !important;
                transition: var(--transition) !important;
                padding: 5px !important;
            }

            .password-toggle:hover {
                color: var(--claude-primary) !important;
            }

            /* è¼‰å…¥å’Œè¨Šæ¯ç‹€æ…‹ */
            .loading-overlay {
                display: none !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.5) !important;
                z-index: 9999 !important;
                align-items: center !important;
                justify-content: center !important;
            }

            .loading-content {
                background: var(--claude-card) !important;
                padding: 30px !important;
                border-radius: var(--border-radius) !important;
                text-align: center !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid var(--claude-border) !important;
            }

            .loading-spinner {
                font-size: 2rem !important;
                color: var(--claude-primary) !important;
                animation: spin 1s linear infinite !important;
                margin: 0 0 15px 0 !important;
            }

            @keyframes spin {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .message {
                padding: 15px 20px !important;
                border-radius: var(--border-radius) !important;
                margin: 15px 0 !important;
                display: none !important;
                align-items: center !important;
                gap: 10px !important;
                font-weight: 500 !important;
            }

            .message.success {
                background: rgba(34, 197, 94, 0.1) !important;
                border: 1px solid rgba(34, 197, 94, 0.3) !important;
                color: #4ade80 !important;
            }

            .message.error {
                background: rgba(239, 68, 68, 0.1) !important;
                border: 1px solid rgba(239, 68, 68, 0.3) !important;
                color: #fca5a5 !important;
            }

            .message.show {
                display: flex !important;
                animation: slideIn 0.3s ease-out !important;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(40px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
            @media (max-width: 768px) {
                body {
                    padding: 10px !important;
                }

                .settings-card {
                    padding: 30px 20px !important;
                }

                .settings-title {
                    font-size: 2rem !important;
                    flex-direction: column !important;
                    gap: 10px !important;
                }

                .btn-group {
                    flex-direction: column !important;
                }

                .settings-btn {
                    min-width: auto !important;
                }
            }
        </style>
    </head>

    <body>
        <div class="settings-container">
            <!-- é é¢æ¨™é¡Œ -->
            <div class="settings-header">
                <div class="settings-header-content">
                    <h1 class="settings-title">
                        <i class="fas fa-user-cog"></i>
                        å€‹äººè¨­å®š
                    </h1>
                    <p class="settings-subtitle">ç®¡ç†æ‚¨çš„å€‹äººè³‡æ–™å’Œå¸³æˆ¶è¨­å®š</p>
                </div>
            </div>

            <!-- ä¸»è¦è¨­å®šå€åŸŸ -->
            <div class="settings-card">
                <div class="settings-content">
                    <!-- ä½¿ç”¨è€…è³‡è¨Šå±•ç¤º -->
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-name" id="displayUserName">è¼‰å…¥ä¸­...</div>
                        <div class="user-id" id="displayUserId">ID: ---</div>
                    </div>

                    <!-- è¨Šæ¯é¡¯ç¤ºå€åŸŸ -->
                    <div class="message success" id="successMessage">
                        <i class="fas fa-check-circle"></i>
                        <span id="successText">æ“ä½œæˆåŠŸ</span>
                    </div>
                    <div class="message error" id="errorMessage">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="errorText">ç™¼ç”ŸéŒ¯èª¤</span>
                    </div>

                    <!-- è¨­å®šè¡¨å–® -->
                    <form class="settings-form" id="settingsForm">
                        <div class="form-group">
                            <label class="form-label" for="userId">
                                <i class="fas fa-id-badge"></i>
                                ä½¿ç”¨è€…ç·¨è™Ÿ
                            </label>
                            <input type="text" id="userId" class="form-input" disabled placeholder="è‡ªå‹•ç”Ÿæˆ" />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="userName">
                                <i class="fas fa-user"></i>
                                ä½¿ç”¨è€…åç¨±
                            </label>
                            <input
                                type="text"
                                id="userName"
                                class="form-input"
                                placeholder="è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±"
                                required
                            />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">
                                <i class="fas fa-lock"></i>
                                å¯†ç¢¼
                            </label>
                            <div class="password-group">
                                <input
                                    type="password"
                                    id="password"
                                    class="form-input"
                                    placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼ˆç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹ï¼‰"
                                />
                                <button type="button" class="password-toggle" onclick="togglePassword()">
                                    <i class="fas fa-eye" id="passwordIcon"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="usageTime">
                                <i class="fas fa-clock"></i>
                                ç´¯è¨ˆä½¿ç”¨æ™‚é–“
                            </label>
                            <input type="text" id="usageTime" class="form-input" disabled placeholder="00:00:00" />
                        </div>

                        <!-- æŒ‰éˆ•çµ„ -->
                        <div class="btn-group">
                            <button type="submit" class="settings-btn btn-save">
                                <i class="fas fa-save"></i>
                                å„²å­˜è¨­å®š
                            </button>
                            <button type="button" class="settings-btn btn-reset" onclick="resetForm()">
                                <i class="fas fa-undo"></i>
                                é‡ç½®
                            </button>
                            <button type="button" class="settings-btn btn-delete" onclick="deleteAccount()">
                                <i class="fas fa-trash"></i>
                                åˆªé™¤å¸³è™Ÿ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- è¼‰å…¥è¦†è“‹å±¤ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner">
                    <i class="fas fa-spinner"></i>
                </div>
                <p>è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>
            </div>
        </div>

        <script>
            // å…¨åŸŸè®Šæ•¸
            let currentUser = null;
            let originalUserData = null;

            // API åŸºæº– URL
            function getApiBase() {
                const currentHostname = window.location.hostname;
                const currentOrigin = window.location.origin;

                if (currentHostname.includes("github.io")) {
                    return "https://1140412connectproject-production.up.railway.app/api";
                } else if (currentHostname === "localhost" || currentHostname === "127.0.0.1") {
                    return "https://1140412connectproject-production.up.railway.app/api";
                } else if (currentHostname.includes("railway.app")) {
                    return currentOrigin + "/api";
                } else {
                    return "https://1140412connectproject-production.up.railway.app/api";
                }
            }

            // åˆå§‹åŒ–
            document.addEventListener("DOMContentLoaded", function () {
                loadUserSettings();
            });

            // è¼‰å…¥ä½¿ç”¨è€…è¨­å®š
            async function loadUserSettings() {
                try {
                    showLoading(true);

                    // å¾ localStorage ç²å–ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š
                    const sessionData = localStorage.getItem("kilin_user_session");
                    const guestData = localStorage.getItem("kilin_guest_session");

                    if (guestData) {
                        showError("éŠå®¢æ¨¡å¼ç„¡æ³•ä¿®æ”¹å€‹äººè¨­å®š");
                        return;
                    }

                    if (!sessionData) {
                        showError("è«‹å…ˆç™»å…¥å¾Œå†ä½¿ç”¨å€‹äººè¨­å®šåŠŸèƒ½");
                        return;
                    }

                    currentUser = JSON.parse(sessionData);

                    // å¾ API ç²å–æœ€æ–°çš„ä½¿ç”¨è€…è³‡æ–™
                    const API_BASE = getApiBase();
                    const response = await fetch(`${API_BASE}/users`);

                    if (!response.ok) {
                        throw new Error("ç„¡æ³•è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™");
                    }

                    const users = await response.json();
                    const userData = users.find((u) => u.user_id == currentUser.user_id);

                    if (!userData) {
                        throw new Error("æ‰¾ä¸åˆ°ä½¿ç”¨è€…è³‡æ–™");
                    }

                    // å„²å­˜åŸå§‹è³‡æ–™
                    originalUserData = { ...userData };

                    // å¡«å…¥è¡¨å–®
                    document.getElementById("userId").value = userData.user_id || "";
                    document.getElementById("userName").value = userData.user_name || "";
                    document.getElementById("usageTime").value = userData.usage_time || "00:00:00";

                    // æ›´æ–°é¡¯ç¤ºè³‡è¨Š
                    document.getElementById("displayUserName").textContent = userData.user_name || "æœªè¨­å®š";
                    document.getElementById("displayUserId").textContent = `ID: ${userData.user_id || "---"}`;

                    showLoading(false);
                    console.log("âœ… ä½¿ç”¨è€…è¨­å®šè¼‰å…¥æˆåŠŸ");
                } catch (error) {
                    console.error("âŒ è¼‰å…¥ä½¿ç”¨è€…è¨­å®šå¤±æ•—:", error);
                    showError(error.message);
                    showLoading(false);
                }
            }

            // è™•ç†è¡¨å–®æäº¤
            document.getElementById("settingsForm").addEventListener("submit", async function (e) {
                e.preventDefault();
                await saveSettings();
            });

            // å„²å­˜è¨­å®š
            async function saveSettings() {
                try {
                    showLoading(true);

                    const formData = {
                        table: "users",
                        user_id: document.getElementById("userId").value,
                        user_name: document.getElementById("userName").value.trim(),
                        usage_time: document.getElementById("usageTime").value,
                        state: "0",
                    };

                    // åªæœ‰åœ¨è¼¸å…¥æ–°å¯†ç¢¼æ™‚æ‰æ›´æ–°å¯†ç¢¼
                    const newPassword = document.getElementById("password").value.trim();
                    if (newPassword) {
                        formData.password = newPassword;
                    } else {
                        formData.password = originalUserData.password; // ä½¿ç”¨åŸå¯†ç¢¼
                    }

                    // é©—è­‰å¿…å¡«æ¬„ä½
                    if (!formData.user_name) {
                        throw new Error("ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º");
                    }

                    const API_BASE = getApiBase();
                    const response = await fetch(`${API_BASE}/2/update`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formData),
                    });

                    if (response.ok) {
                        // æ›´æ–° localStorage ä¸­çš„ä½¿ç”¨è€…è³‡è¨Š
                        currentUser.user_name = formData.user_name;
                        if (newPassword) {
                            currentUser.password = newPassword;
                        }
                        localStorage.setItem("kilin_user_session", JSON.stringify(currentUser));

                        // æ›´æ–°é¡¯ç¤ºè³‡è¨Š
                        document.getElementById("displayUserName").textContent = formData.user_name;

                        // æ¸…ç©ºå¯†ç¢¼æ¬„ä½
                        document.getElementById("password").value = "";

                        showSuccess("å€‹äººè¨­å®šæ›´æ–°æˆåŠŸï¼");
                        console.log("âœ… è¨­å®šå„²å­˜æˆåŠŸ");
                    } else {
                        const errorText = await response.text();
                        throw new Error(`æ›´æ–°å¤±æ•—: ${errorText}`);
                    }
                } catch (error) {
                    console.error("âŒ å„²å­˜è¨­å®šå¤±æ•—:", error);
                    showError(error.message);
                } finally {
                    showLoading(false);
                }
            }

            // é‡ç½®è¡¨å–®
            function resetForm() {
                if (originalUserData) {
                    document.getElementById("userName").value = originalUserData.user_name || "";
                    document.getElementById("password").value = "";
                    showSuccess("è¡¨å–®å·²é‡ç½®");
                }
            }

            // åˆªé™¤å¸³è™Ÿ
            async function deleteAccount() {
                const confirmMessage = `âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤æ‚¨çš„å¸³è™Ÿï¼\n\nç¢ºå®šè¦åˆªé™¤å¸³è™Ÿã€Œ${currentUser.user_name}ã€å—ï¼Ÿ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`;

                if (!confirm(confirmMessage)) {
                    return;
                }

                const secondConfirm = confirm("æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦åˆªé™¤å¸³è™Ÿå—ï¼Ÿ");
                if (!secondConfirm) {
                    return;
                }

                try {
                    showLoading(true);

                    const deleteData = {
                        table: "users",
                        user_id: currentUser.user_id,
                        user_name: currentUser.user_name,
                        password: originalUserData.password,
                        usage_time: originalUserData.usage_time || "00:00:00",
                        state: "-1", // è¨­ç‚ºåˆªé™¤ç‹€æ…‹
                    };

                    const API_BASE = getApiBase();
                    const response = await fetch(`${API_BASE}/2/update`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(deleteData),
                    });

                    if (response.ok) {
                        alert("å¸³è™Ÿå·²æˆåŠŸåˆªé™¤ï¼Œå³å°‡è·³è½‰åˆ°ç™»å…¥é é¢");

                        // æ¸…é™¤æœ¬åœ°æœƒè©±
                        localStorage.removeItem("kilin_user_session");
                        localStorage.removeItem("kilin_guest_session");

                        // è·³è½‰åˆ°ç™»å…¥é é¢
                        window.location.href = "login.html";
                    } else {
                        const errorText = await response.text();
                        throw new Error(`åˆªé™¤å¤±æ•—: ${errorText}`);
                    }
                } catch (error) {
                    console.error("âŒ åˆªé™¤å¸³è™Ÿå¤±æ•—:", error);
                    showError(error.message);
                } finally {
                    showLoading(false);
                }
            }

            // åˆ‡æ›å¯†ç¢¼é¡¯ç¤º
            function togglePassword() {
                const passwordInput = document.getElementById("password");
                const passwordIcon = document.getElementById("passwordIcon");

                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    passwordIcon.className = "fas fa-eye-slash";
                } else {
                    passwordInput.type = "password";
                    passwordIcon.className = "fas fa-eye";
                }
            }

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            function showLoading(show = true) {
                const overlay = document.getElementById("loadingOverlay");
                if (show) {
                    overlay.style.display = "flex";
                } else {
                    overlay.style.display = "none";
                }
            }

            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            function showSuccess(message) {
                hideAllMessages();
                const successMessage = document.getElementById("successMessage");
                const successText = document.getElementById("successText");
                successText.textContent = message;
                successMessage.classList.add("show");

                // 3ç§’å¾Œè‡ªå‹•éš±è—
                setTimeout(() => {
                    successMessage.classList.remove("show");
                }, 3000);
            }

            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            function showError(message) {
                hideAllMessages();
                const errorMessage = document.getElementById("errorMessage");
                const errorText = document.getElementById("errorText");
                errorText.textContent = message;
                errorMessage.classList.add("show");

                // 5ç§’å¾Œè‡ªå‹•éš±è—
                setTimeout(() => {
                    errorMessage.classList.remove("show");
                }, 5000);
            }

            // éš±è—æ‰€æœ‰è¨Šæ¯
            function hideAllMessages() {
                document.getElementById("successMessage").classList.remove("show");
                document.getElementById("errorMessage").classList.remove("show");
            }

            // éµç›¤å¿«æ·éµ
            document.addEventListener("keydown", function (e) {
                // Ctrl/Cmd + S å„²å­˜
                if ((e.ctrlKey || e.metaKey) && e.key === "s") {
                    e.preventDefault();
                    saveSettings();
                }

                // ESC é‡ç½®è¡¨å–®
                if (e.key === "Escape") {
                    resetForm();
                }
            });

            console.log("ğŸµ ä½¿ç”¨è€…è¨­å®šé é¢åˆå§‹åŒ–å®Œæˆ");
        </script>
    </body>
</html>
