<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <title>æ–°å¢ç”¨æˆ¶</title>
        <link rel="stylesheet" href="main.css" />
        <style>
            .form-hint {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
                font-style: italic;
            }

            .required {
                color: red;
            }

            .usage-time-display {
                font-size: 11px;
                color: #999;
                margin-top: 3px;
                opacity: 0.7;
            }
        </style>
    </head>
    <body>
        <h2>ğŸ‘¤ æ–°å¢ç”¨æˆ¶</h2>

        <label for="user_name">ç”¨æˆ¶åç¨± <span class="required">*</span></label>
        <input type="text" id="user_name" placeholder="è«‹è¼¸å…¥ç”¨æˆ¶åç¨±" required />
        <div class="form-hint">ç”¨æˆ¶åç¨±ä¸å¯é‡è¤‡</div>

        <label for="password">å¯†ç¢¼ <span class="required">*</span></label>
        <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required />

        <div class="usage-time-display">ğŸ’¡ ä½¿ç”¨æ™‚é–“çµ±è¨ˆï¼šæ–°ç”¨æˆ¶åˆå§‹ç‚º 00:00:00ï¼Œç³»çµ±æœƒè‡ªå‹•å¾ç™»å…¥é–‹å§‹ç´¯è¨ˆä½¿ç”¨æ™‚é–“</div>

        <button>æ–°å¢ç”¨æˆ¶</button>

        <script>
            const currentHostname = window.location.hostname;
            const currentOrigin = window.location.origin;

            let API_BASE;
            if (currentHostname.includes("github.io")) {
                // GitHub Pages ç’°å¢ƒ
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("â˜ï¸ GitHub Pages ç’°å¢ƒï¼Œä½¿ç”¨ Railway å¾Œç«¯");
            } else if (currentHostname === "localhost" || currentHostname === "127.0.0.1") {
                // æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
                API_BASE = "http://localhost:8000/api";
                console.log("ğŸ  æœ¬åœ°é–‹ç™¼ç’°å¢ƒ");
            } else if (currentHostname.includes("railway.app")) {
                // ç›´æ¥è¨ªå• Railway æ‡‰ç”¨
                API_BASE = currentOrigin + "/api";
                console.log("ğŸš‚ Railway ç’°å¢ƒï¼Œä½¿ç”¨ç›¸å°è·¯å¾‘");
            } else {
                // å…¶ä»–ç’°å¢ƒï¼Œé è¨­ä½¿ç”¨ Railway
                API_BASE = "https://1140412connectproject-production.up.railway.app/api";
                console.log("ğŸŒ æœªçŸ¥ç’°å¢ƒï¼Œé è¨­ä½¿ç”¨ Railway å¾Œç«¯");
            }
            console.log("ğŸ“¡ Insert API_BASE:", API_BASE);

            // æ–°å¢ç”¨æˆ¶å‡½æ•¸
            window.insertpost = async function () {
                try {
                    // å–å¾—è¡¨å–®è³‡æ–™
                    let userName = document.getElementById("user_name").value.trim();
                    let password = document.getElementById("password").value.trim();
                    let usageTime = "00:00:00"; // åˆå§‹ä½¿ç”¨æ™‚é–“
                    let state = "0";

                    console.log("è³‡æ–™:", { userName, password, usageTime, state });
                    console.log("ä½¿ç”¨ API ç«¯é»:", `${API_BASE}/2/insert`);

                    if (userName && password) {
                        const response = await fetch(`${API_BASE}/2/insert`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                table: "users",
                                user_name: userName,
                                password: password,
                                usage_time: usageTime,
                                state: state,
                            }),
                        });

                        if (response.ok) {
                            console.log("âœ… ç”¨æˆ¶æ–°å¢æˆåŠŸ");
                            alert("ç”¨æˆ¶æ–°å¢æˆåŠŸï¼");
                            // æ¸…ç©ºè¡¨å–®
                            document.getElementById("user_name").value = "";
                            document.getElementById("password").value = "";
                        } else {
                            const errorText = await response.text();
                            console.error("âŒ æ–°å¢å¤±æ•—:", response.status, errorText);
                            alert(`æ–°å¢å¤±æ•—: ${errorText}`);
                        }
                    } else {
                        alert("è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼");
                    }
                } catch (error) {
                    console.error("âŒ è«‹æ±‚éŒ¯èª¤:", error);
                    alert(`æ–°å¢å¤±æ•—: ${error.message}`);
                }
            };

            console.log("DOM è¼‰å…¥å®Œæˆ");
            const btn = document.querySelector("button");
            console.log("æ‰¾åˆ°æŒ‰éˆ•:", btn);
            if (btn) {
                btn.addEventListener("click", function () {
                    console.log("æŒ‰éˆ•é»æ“Šäº‹ä»¶è§¸ç™¼");
                    window.insertpost();
                });
                console.log("äº‹ä»¶ç›£è½å™¨å·²ç¶å®š");
            }
            console.log("Script åŸ·è¡Œå®Œç•¢");
        </script>
    </body>
</html>
